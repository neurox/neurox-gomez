<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on JUANING.dev</title><link>https://www.juaning.dev/post/</link><description>JUANING.dev (Posts)</description><generator>Hugo -- gohugo.io</generator><language>en-US</language><copyright>JUANING</copyright><lastBuildDate>Thu, 24 Nov 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://www.juaning.dev/post/index.xml" rel="self" type="application/rss+xml"/><item><title>Install and enable FTP access in AWS EC2 instance with Linux Centos 7</title><link>https://www.juaning.dev/post/2022/2022-11-24-install-and-enable-ftp-access-in-aws-ec2-instance-with-linux-centos-7/</link><pubDate>Thu, 24 Nov 2022 00:00:00 +0000</pubDate><guid>https://www.juaning.dev/post/2022/2022-11-24-install-and-enable-ftp-access-in-aws-ec2-instance-with-linux-centos-7/</guid><description>&lt;p>I&amp;rsquo;ll guide you trough the fastest and easiest way to setup FTP access to an AWS(Amazon Web Services)
EC2 Linux instance with Centos 7 distribution, we are going to use VSFTPD(Very Secure FTP Daemon) so the first
step is to install it.&lt;/p>
&lt;h2>Step 1: Install VSFTPD&lt;/h2>
&lt;p>1.1 Update the package manager:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo yum update&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>1.2 Install VSFTP software:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo yum install vsftpd&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>1.3 Start the service:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo systemctl start vsftpd&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>1.4 Set the service to auto launch when the system boot:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo systemctl enable vsftpd&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;h2>Step 2: Create a new FTP user&lt;/h2>
&lt;p>2.1 The following command will create a new user:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo adduser ftpuser&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>2.2 Set a password for the new user:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo passwd ftpuser&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>2.3 Add the new user to the VSFTP userlist:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> echo &lt;span style="color:#e6db74">&amp;#34;ftpuser&amp;#34;&lt;/span> | sudo tee -a /etc/vsftpd/user_list&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;h2>Step 3: Configure VSFTPD&lt;/h2>
&lt;p>3.1 First, create a backup copy of the configuration file:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.default&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>3.2 Open the configuration file with vim:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo nano /etc/vsftpd/vsftpd.conf&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>3.3 Look for the following variables and update as below:&lt;br>
&lt;strong>Note:&lt;/strong> some of the variables could not exist, just add the line at the end of the file
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> anonymous_enable&lt;span style="color:#f92672">=&lt;/span>NO
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> write_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> chroot_local_user&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> allow_writeable_chroot&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> userlist_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> userlist_file&lt;span style="color:#f92672">=&lt;/span>/etc/vsftpd/user_list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> userlist_deny&lt;span style="color:#f92672">=&lt;/span>NO&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>3.4 Restart the service:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo systemctl restart vsftpd&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;h2>Step 4: Create a directory for the new user&lt;/h2>
&lt;p>4.1 Create the directory inside the user root location:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo mkdir -p /home/ftpuser/ftp/upload&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>4.2 Set permissions to the new directories:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo chmod &lt;span style="color:#ae81ff">550&lt;/span> /home/ftpuser/ftp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sudo chmod &lt;span style="color:#ae81ff">750&lt;/span> /home/ftpuser/ftp/upload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sudo chown -R ftpuser: /home/ftpuser/ftp&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;h2>Troubleshooting:&lt;/h2>
&lt;h3>Issue 1: Access Denied&lt;/h3>
By default, AWS EC2 Linux instances just allows conections with a private key, this means that
in order to connect trough ssh to the instance you need to use the following command:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> ssh -i your-private-key.pem username@ec2_ip_address&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>1.1 Edit the sshd_config file:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo vi /etc/ssh/sshd_config&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>1.2 Add the following lines to the end of the file:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> Match User ftpuser
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PasswordAuthentication yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ChrootDirectory /home/ftpuser/ftp&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>1.3 Restart the service:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span> sudo service sshd restart&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p></description></item></channel></rss>